import{e as b,i as q,m as A,r as p,f as x,w as u,o as i,k as v,b as _,g as e,ab as V,c as h,t as m,a as E,n as R}from"./DBeo1IW4.js";import{u as B,s as d}from"./CvSZD4Vs.js";import{u as P,a as $}from"./DlN5vOC-.js";import{_ as S}from"./DJ8cwUYa.js";import{V as N}from"./ChXO4y9j.js";import{V as I,a as T}from"./BSr-QuFa.js";import{y as z}from"./HAnE_YmP.js";import"./D5O00cGW.js";import"./DxeCKos8.js";import"./B5CZD0j7.js";import"./-RgTJB7T.js";import"./CkIa2Ul0.js";import"./CrUB5o6X.js";const D={key:0,class:"my-2"},M={key:1,class:"my-2"},j={key:2,class:"my-2"},F={class:"my-2"},G={class:"my-2"},le=b({__name:"[method]",setup(H){const C=q(),a=A(),t=p(0),o=p(!1),n=p(!1),{getState:k}=B();console.log("a"),console.log(a.query.state);const c=k(a.query.state.toString(),!0),w=p("");console.log("b");const y=()=>{R(c.RedirectUri,{external:!0})},L=async()=>{const l=await $(c,w.value);if(l){const s=new URL(l).searchParams.get("error");s?s=="access_denied"&&(o.value=!0,t.value=3):R(l,{external:!0})}else o.value=!0,t.value=2},U=async()=>{if(!a.query.code){o.value=!0,t.value=2;return}console.log(1);const l=a.query.code.toString(),r=`${window.location.origin}${C.resolve(`/account/${a.params.method.toString()}`).href}`;console.log(r),console.log(2);const{CreateToken:s,RedirectURI:g}=await P(c,l,r,a.params.method.toString(),!1);if(console.log(3),s&&(w.value=s,console.log(4)),console.log(5),g){console.log(6),console.log(g);const f=new URL(g).searchParams.get("error");f?f=="access_denied"?(console.log(8),n.value=!0):f=="invalid_request"?(console.log(9),o.value=!0,t.value=1):f=="server_error"&&(console.log(10),o.value=!0,t.value=2):(console.log(7),console.log(g),console.log("SUCCESS"),await C.push("/account"))}else console.log(11),o.value=!0,t.value=2};return console.log("c"),c?(console.log("d"),U()):(console.log("e"),console.log(c),o.value=!0,t.value=2),(l,r)=>(i(),x(N,{class:"h-100"},{default:u(()=>[!e(n)&&!e(o)?(i(),x(I,{key:0,class:"h-100"},{default:u(()=>[_(T,{class:"text-center align-content-center"},{default:u(()=>[_(z,{color:"primary",size:110,width:12,indeterminate:""})]),_:1})]),_:1})):v("",!0),_(S,{modelValue:e(o),"onUpdate:modelValue":r[0]||(r[0]=s=>V(o)?o.value=s:null),"show-save-action":!1,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Error Attempting Login","hide-extension":!0,"remove-button-spacer":!0,"close-action-label":"Close",onClose:y},{default:u(()=>[e(t)===1?(i(),h("p",D,m(e(d).messageCreateExternalError1),1)):v("",!0),e(t)===2?(i(),h("p",M,m(e(d).messageCreateExternalError2),1)):v("",!0),e(t)===3?(i(),h("p",j,m(e(d).messageCreateExternalError3),1)):v("",!0)]),_:1},8,["modelValue"]),_(S,{modelValue:e(n),"onUpdate:modelValue":r[1]||(r[1]=s=>V(n)?n.value=s:null),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",persistent:!0,"retain-focus":!0,onSave:L,onClose:y},{default:u(()=>[E("p",F,m(e(d).messageCreateExternalAccount1),1),E("p",G,m(e(d).messageCreateExternalAccount2),1)]),_:1},8,["modelValue"])]),_:1}))}});export{le as default};
