import{T as h}from"./bg8s6OZq.js";import{h as T,e as y,r as p,R as C,aS as $,j as b,n as g,f as w,k as A,g as i,o as B,w as a,b as o,d as I,ab as R,aR as S,i as x}from"./DBeo1IW4.js";import{u as N}from"./Bbkovp5K.js";import{V as D,a as U,b as z,c as L}from"./upwAq0vX.js";import{d as M}from"./-RgTJB7T.js";import{V as E,a as f}from"./BYdPoSG_.js";import{V as O,a as j}from"./Ck-PQRGo.js";import"./B5CZD0j7.js";import"./D5O00cGW.js";import"./CrUB5o6X.js";import"./HAnE_YmP.js";import"./CkIa2Ul0.js";import"./9JiKvfbA.js";import"./Bn-V7LnJ.js";const Y=()=>h.getInstance(),q=async()=>{const u=T(),t=h.getInstance().getTokenByService("graze");return await $fetch(`${u.public.issuerUri}/api/access_check`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}})},re=y({__name:"admin",async setup(u){let r,t;const s=p(!1),{xs:k}=C(),c=$(),m=Y(),d=p(!1),v=()=>{c.global.name.value=c.global.current.value.dark?"light":"dark"};try{[r,t]=b(()=>q()),r=await r,t(),r&&(d.value=!0)}catch(n){const e=n;(e.message.includes("401")||e.message.includes("403"))&&(m.removeTokensByService("graze"),g(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const V=async()=>{const n=x(),e=await N(),l=encodeURIComponent(`${window.location.origin}${n.resolve("/admin").href}`),_=`${e.EndSessionEndpoint}?client_id=internal&post_logout_redirect_uri=${l}`;m.removeTokensByService("graze"),g(_,{external:!0})};return(n,e)=>i(d)?(B(),w(j,{key:0},{default:a(()=>[o(D,{color:"primary","scroll-behavior":"collapse"},{default:a(()=>[o(U,null,{default:a(()=>[...e[2]||(e[2]=[I("Dashboard",-1)])]),_:1}),o(M),o(z,{onClick:e[0]||(e[0]=l=>s.value=!i(s))})]),_:1}),o(L,{modelValue:i(s),"onUpdate:modelValue":e[1]||(e[1]=l=>R(s)?s.value=l:null),location:i(k)?"top":"right",temporary:""},{default:a(()=>[o(E,null,{default:a(()=>[o(f,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:v,title:`${i(c).global.name.value=="dark"?"Light":"Dark"} Mode`},null,8,["title"]),o(f,{"prepend-icon":"mdi:mdi-logout",onClick:V,title:"Logout"})]),_:1})]),_:1},8,["modelValue","location"]),o(O,null,{default:a(()=>[S(n.$slots,"default")]),_:3})]),_:3})):A("",!0)}});export{re as default};
