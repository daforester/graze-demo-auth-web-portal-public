import{h as b,e as $,V as N,Y as M,M as w,f as V,w as m,X as E,o as p,R,b as y,g as r,S,c as T,t as h,a as A}from"./DU_nv6qb.js";import{s as g}from"./DeTKzWR2.js";import{u as L}from"./mm0nQsJ-.js";import{_ as U}from"./BLGJzCYI.js";import{u as q}from"./DANHJ8r9.js";import{V as I}from"./epPG9Ibe.js";import{V as O,a as B}from"./DVHrX6do.js";import{w as J}from"./BFc9MCJK.js";import"./B5CZD0j7.js";import"./CglTRRRa.js";import"./9qXTopoB.js";import"./C3fS7Lrv.js";import"./1d_XzYus.js";const P=async(_,f,c,t,e=!1)=>{const o=b(),{getAccessToken:s,storeAccessToken:l,storeRefreshToken:k}=L();let d="";try{d=await s()}catch{}try{return await $fetch(`${o.public.issuerUri}/connect/auth/${t}`,{method:"post",body:JSON.stringify({oauth:_,access_token:d,external:{code:f,redirect_uri:c},new:e}),parseResponse:C=>{const a=JSON.parse(C);return a.AccessToken&&l(a.AccessToken),a.RefreshToken&&k(a.RefreshToken),{CreateToken:a.CreateToken||"",RedirectURI:a.RedirectURI||"",ErrorMessage:a.ErrorMessage||"",Existing:a.Existing||!1}}})}catch{return""}},z=async(_,f)=>{const c=b(),{storeAccessToken:t,storeRefreshToken:e}=L();try{return await $fetch(`${c.public.issuerUri}/connect/auth/create`,{method:"post",body:JSON.stringify({oauth:_,create_token:f,new:!0}),parseResponse:o=>{const s=JSON.parse(o);return s.AccessToken&&t(s.AccessToken),s.RefreshToken&&e(s.RefreshToken),{ErrorMessage:s.ErrorMessage||"",RedirectURI:s.RedirectURI||""}}})}catch{return""}},D={key:0,class:"my-2"},X={key:1,class:"my-2"},Y={key:2,class:"my-2"},j={class:"my-2"},F={class:"my-2"},ie=$({__name:"[method]",setup(_){const f=N(),c=M(),t=w(0),e=w(!1),o=w(!1),{getState:s}=q(),l=s(c.query.state.toString(),!0),k=w(""),d=()=>{E(l.RedirectUri,{external:!0})},C=async()=>{const u=await z(l,k.value);if(u){const n=new URL(u).searchParams.get("error");n?n=="access_denied"&&(e.value=!0,t.value=3):E(u,{external:!0})}else e.value=!0,t.value=2};return l?(async()=>{if(!c.query.code){e.value=!0,t.value=2;return}const u=c.query.code.toString(),i=`${window.location.origin}${f.resolve("/connect/external").href}/keycloak`,{create_token:n,redirect_uri:x}=await P(l,u,i,c.params.method.toString(),!1);if(n&&(k.value=n),x){const v=new URL(x).searchParams.get("error");v?v=="access_denied"?o.value=!0:v=="invalid_request"?(e.value=!0,t.value=1):v=="server_error"&&(e.value=!0,t.value=2):E(x,{external:!0})}else e.value=!0,t.value=2})():(e.value=!0,t.value=2),(u,i)=>(p(),V(I,{class:"h-100"},{default:m(()=>[!r(o)&&!r(e)?(p(),V(O,{key:0,class:"h-100"},{default:m(()=>[y(B,{class:"text-center align-content-center"},{default:m(()=>[y(J,{color:"primary",size:110,width:12,indeterminate:""})]),_:1})]),_:1})):R("",!0),y(U,{modelValue:r(e),"onUpdate:modelValue":i[0]||(i[0]=n=>S(e)?e.value=n:null),"show-save-action":!1,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Error Attempting Login","hide-extension":!0,"remove-button-spacer":!0,"close-action-label":"Close",onClose:d},{default:m(()=>[r(t)===1?(p(),T("p",D,h(r(g).messageCreateExternalError1),1)):R("",!0),r(t)===2?(p(),T("p",X,h(r(g).messageCreateExternalError2),1)):R("",!0),r(t)===3?(p(),T("p",Y,h(r(g).messageCreateExternalError3),1)):R("",!0)]),_:1},8,["modelValue"]),y(U,{modelValue:r(o),"onUpdate:modelValue":i[1]||(i[1]=n=>S(o)?o.value=n:null),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",persistent:!0,"retain-focus":!0,onSave:C,onClose:d},{default:m(()=>[A("p",j,h(r(g).messageCreateExternalAccount1),1),A("p",F,h(r(g).messageCreateExternalAccount2),1)]),_:1},8,["modelValue"])]),_:1}))}});export{ie as default};
