import{_ as V}from"./DNvhtt3t.js";import{u as E,L as d,_ as q}from"./CAHDsF8o.js";import{u as U}from"./CwZHMiK4.js";import{u as P}from"./Ca7Pyskc.js";import{e as b,i as $,r as _,j as x,l as z,c as A,o as r,f as u,k as i,w as e,b as t,h as N,m as F,n as S,a as G,t as M,g as B,F as J,d as K}from"./9q-fxqZG.js";import{V as c,a as f}from"./D_6uU0M2.js";import{u as I}from"./mUXC2XSg.js";import{V as D}from"./BAQfXbzc.js";import{V as j}from"./C1XXGx0e.js";import"./C-qTML4P.js";import"./Ci-VC6dV.js";import"./vxhprsWy.js";import"./G_Yx5M8C.js";import"./tu0_jfr3.js";import"./Dwcg0_5Q.js";import"./LS80WArn.js";import"./C8xSek-N.js";import"./B5CZD0j7.js";const H=b({__name:"LoginButtons",props:{showAmazonLogin:{type:Boolean,default:!1},showEmailLogin:{type:Boolean,default:!1},showFaceBookLogin:{type:Boolean,default:!1},showGoogleLogin:{type:Boolean,default:!1},showInstagramLogin:{type:Boolean,default:!1},showKeycloakLogin:{type:Boolean,default:!1},showMicrosoftLogin:{type:Boolean,default:!1},showSteamLogin:{type:Boolean,default:!1},showTelegramLogin:{type:Boolean,default:!1},showTwitchLogin:{type:Boolean,default:!1},showTwitterLogin:{type:Boolean,default:!1}},emits:["login"],async setup(n,{emit:g}){let a,k;const{addState:T}=P(),p=U(),v=$(),m=_();try{m.value=([a,k]=x(()=>E(`${window.location.origin}${v.resolve("/connect/external").href}`)),a=await a,k(),a)}catch(w){console.error(w)}const h=g,s=_("");return z(s,()=>{var R;const w=(R=m.value)==null?void 0:R.get(s.value);if(!w){h("login",{method:s.value});return}const l=new URL(w).searchParams.get("state");l&&T(l,p),h("login",{method:s.value,uri:w})}),(w,o)=>(r(),A("div",null,[n.showEmailLogin?(r(),u(c,{key:0,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"internal",onClick:o[0]||(o[0]=l=>s.value="internal")})]),_:1})]),_:1})):i("",!0),n.showAmazonLogin?(r(),u(c,{key:1,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"amazon",onClick:o[1]||(o[1]=l=>s.value="amazon")})]),_:1})]),_:1})):i("",!0),n.showFaceBookLogin?(r(),u(c,{key:2,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"facebook",onClick:o[2]||(o[2]=l=>s.value="facebook")})]),_:1})]),_:1})):i("",!0),n.showGoogleLogin?(r(),u(c,{key:3,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"google",onClick:o[3]||(o[3]=l=>s.value="google")})]),_:1})]),_:1})):i("",!0),n.showInstagramLogin?(r(),u(c,{key:4,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"instagram",onClick:o[4]||(o[4]=l=>s.value="instagram")})]),_:1})]),_:1})):i("",!0),n.showMicrosoftLogin?(r(),u(c,{key:5,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"microsoft",onClick:o[5]||(o[5]=l=>s.value="microsoft")})]),_:1})]),_:1})):i("",!0),n.showSteamLogin?(r(),u(c,{key:6,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"steam",onClick:o[6]||(o[6]=l=>s.value="steam")})]),_:1})]),_:1})):i("",!0),n.showTelegramLogin?(r(),u(c,{key:7,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"telegram"})]),_:1})]),_:1})):i("",!0),n.showTwitchLogin?(r(),u(c,{key:8,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"twitch",onClick:o[7]||(o[7]=l=>s.value="twitch")})]),_:1})]),_:1})):i("",!0),n.showTwitterLogin?(r(),u(c,{key:9,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"twitter",onClick:o[8]||(o[8]=l=>s.value="twitter")})]),_:1})]),_:1})):i("",!0),n.showKeycloakLogin?(r(),u(c,{key:10,dense:!0},{default:e(()=>[t(f,null,{default:e(()=>[t(d,{source:"keycloak",onClick:o[9]||(o[9]=l=>s.value="keycloak")})]),_:1})]),_:1})):i("",!0)]))}}),Q=()=>{try{const n=$(),g=n.currentRoute.value.query.state||"",a=new URL(n.currentRoute.value.query.redirect_uri||"");return a.searchParams.set("state",g),a.toString()}catch(n){console.error(n)}return""},W=async n=>{const g=N();try{return await $fetch(`${g.public.issuerUri}/connect/style/${n}`,{method:"get",parseResponse:a=>{try{return JSON.parse(a)}catch{throw a}}})}catch{return{}}},X=async n=>{const g=N(),{getAccessToken:a,storeAccessToken:k,storeRefreshToken:T}=I();let p="";try{p=await a()}catch{throw new Error("no access token available")}try{return await $fetch(`${g.public.issuerUri}/connect/auth/token`,{method:"post",body:JSON.stringify({oauth:n,access_token:p,new:!1}),parseResponse:v=>{const m=JSON.parse(v);return m.AccessToken&&k(m.AccessToken),m.RefreshToken&&T(m.RefreshToken),{RedirectURI:m.RedirectURI||"",Existing:m.Existing||!1}}})}catch(v){throw v}},Y={class:"text-center"},he=b({__name:"auth",emits:["pageTitle"],async setup(n,{emit:g}){let a,k;const T=N(),{getAccessToken:p}=I();g("pageTitle","Login");const m=Q(),h=_("BUTTONS"),s=async()=>{try{if(F().query.state){const y=U(),C=await X(y);C&&(new URL(C).searchParams.get("error")||S(C,{external:!0}))}}catch{}};let w;try{w=([a,k]=x(()=>p()),a=await a,k(),a),w&&s()}catch{}const o=({method:L,uri:y})=>{switch(L){case"internal":h.value="INTERNAL_LOGIN";break;case"keycloak":S(y,{external:!0});break}},l=$(),R=([a,k]=x(()=>W(l.currentRoute.value.query.client_id)),a=await a,k(),a);if(R){const L=document.createElement("style");L.textContent=R.css,document.head.append(L)}return(L,y)=>{const C=V;return r(),u(D,null,{default:e(()=>[G("h1",Y,M(B(T).public.organisationName),1),B(h)=="BUTTONS"?(r(),A(J,{key:0},[t(H,{showEmailLogin:!0,showKeycloakLogin:!0,showTelegramLogin:!0,onLogin:o,style:{"max-width":"250px"},class:"ma-auto mb-5"}),t(c,null,{default:e(()=>[t(f,{class:"pa-0 text-center"},{default:e(()=>[t(C,{href:B(m)},{default:e(()=>[t(j,{variant:"text"},{default:e(()=>[...y[1]||(y[1]=[K(" Cancel ",-1)])]),_:1})]),_:1},8,["href"])]),_:1})]),_:1})],64)):B(h)=="INTERNAL_LOGIN"?(r(),u(q,{key:1,onCancel:y[0]||(y[0]=O=>h.value="BUTTONS")})):i("",!0)]),_:1})}}});export{he as default};
