import{T as se}from"./bg8s6OZq.js";import{h as de,P as ze,M as Ne,a2 as Pe,G as Q,r as V,s as qe,R as Me,ai as Ee,q as He,l as S,y as Oe,a8 as Ge,b as l,a0 as ie,ak as oe,a9 as X,al as Le,a as k,F as P,a3 as ge,am as je,U as We,aa as Ye,e as ce,an as ee,f as q,o as b,g as s,ac as Je,w as a,k as he,c as te,ad as ke,d as y,ao as Ke,ap as Qe,t as j,ab as D,n as Ve,j as Xe}from"./DBeo1IW4.js";import{f as Ze,j as et,m as Z,_ as xe,b as be,d as $e,e as _e,i as Se,k as Te,V as tt,h as lt,n as at}from"./DJ8cwUYa.js";import{u as nt,g as it,V as Ce,a as ye,m as ot,b as ut,h as rt,c as st,i as dt,d as ct,e as ue}from"./De8j9Ja5.js";import{V as W,a as N}from"./BSr-QuFa.js";import{V as A}from"./HAnE_YmP.js";import{I as we,d as re}from"./-RgTJB7T.js";import{u as vt}from"./CkIa2Ul0.js";import{V as ft}from"./ChXO4y9j.js";import{V as mt}from"./BYdPoSG_.js";import"./B5CZD0j7.js";import"./D5O00cGW.js";import"./CrUB5o6X.js";import"./9JiKvfbA.js";import"./Bn-V7LnJ.js";const pt=async()=>{const e=de(),p=se.getInstance().getTokenByService("graze");return await $fetch(`${e.public.issuerUri}/api/clients`,{method:"get",headers:{Authorization:`Bearer ${p==null?void 0:p.OAuthToken.AccessToken}`}})},gt=Ne({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxHeight:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...rt(),...ut(),...ot()},"VTextarea"),Vt=ze()({name:"VTextarea",directives:{vIntersect:we},inheritAttrs:!1,props:gt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,r){let{attrs:p,emit:g,slots:f}=r;const n=Pe(e,"modelValue"),{isFocused:d,focus:x,blur:u}=nt(e),{onIntersect:w}=dt(e),F=Q(()=>typeof e.counterValue=="function"?e.counterValue(n.value):(n.value||"").toString().length),$=Q(()=>{if(p.maxlength)return p.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),C=V(),i=V(),c=qe(""),_=V(),Y=V(0),{platform:J}=Me(),M=it(e),m=Q(()=>e.persistentPlaceholder||d.value||e.active);function t(){var v;M.isSuppressing.value&&M.update(),_.value!==document.activeElement&&((v=_.value)==null||v.focus()),d.value||x()}function o(v){t(),g("click:control",v)}function le(v){g("mousedown:control",v)}function Ae(v){v.stopPropagation(),t(),X(()=>{n.value="",Ye(e["onClick:clear"],v)})}function Ue(v){var O;const h=v.target;if(!((O=e.modelModifiers)!=null&&O.trim)){n.value=h.value;return}const T=h.value,H=h.selectionStart,B=h.selectionEnd;n.value=T,X(()=>{let z=0;T.trimStart().length===h.value.length&&(z=T.length-h.value.length),H!=null&&(h.selectionStart=H-z),B!=null&&(h.selectionEnd=B-z)})}const E=V(),K=V(Number(e.rows)),ae=Q(()=>["plain","underlined"].includes(e.variant));Ee(()=>{e.autoGrow||(K.value=Number(e.rows))});function I(){X(()=>{if(!_.value)return;if(J.value.firefox){Y.value=12;return}const{offsetWidth:v,clientWidth:h}=_.value;Y.value=Math.max(0,v-h)}),e.autoGrow&&X(()=>{if(!E.value||!i.value)return;const v=getComputedStyle(E.value),h=getComputedStyle(i.value.$el),T=parseFloat(v.getPropertyValue("--v-field-padding-top"))+parseFloat(v.getPropertyValue("--v-input-padding-top"))+parseFloat(v.getPropertyValue("--v-field-padding-bottom")),H=E.value.scrollHeight,B=parseFloat(v.lineHeight),O=Math.max(parseFloat(e.rows)*B+T,parseFloat(h.getPropertyValue("--v-input-control-height"))),z=e.maxHeight?parseFloat(e.maxHeight):parseFloat(e.maxRows)*B+T||1/0,R=Le(H??0,O,z);K.value=Math.floor((R-T)/B),c.value=oe(R)})}He(I),S(n,I),S(()=>e.rows,I),S(()=>e.maxHeight,I),S(()=>e.maxRows,I),S(()=>e.density,I),S(K,v=>{g("update:rows",v)});let U;return S(E,v=>{v?(U=new ResizeObserver(I),U.observe(E.value)):U==null||U.disconnect()}),Oe(()=>{U==null||U.disconnect()}),vt(()=>{const v=!!(f.counter||e.counter||e.counterValue),h=!!(v||f.details),[T,H]=Ge(p),{modelValue:B,...O}=Ce.filterProps(e),z={...ye.filterProps(e),"onClick:clear":Ae};return l(Ce,ie({ref:C,modelValue:n.value,"onUpdate:modelValue":R=>n.value=R,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":ae.value},e.class],style:[{"--v-textarea-max-height":e.maxHeight?oe(e.maxHeight):void 0,"--v-textarea-scroll-bar-width":oe(Y.value)},e.style]},T,O,{centerAffix:K.value===1&&!ae.value,focused:d.value}),{...f,default:R=>{let{id:G,isDisabled:ve,isDirty:fe,isReadonly:Re,isValid:De,hasDetails:Fe}=R;return l(ye,ie({ref:i,style:{"--v-textarea-control-height":c.value},onClick:o,onMousedown:le,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},z,{id:G.value,active:m.value||fe.value,labelId:`${G.value}-label`,centerAffix:K.value===1&&!ae.value,dirty:fe.value||e.dirty,disabled:ve.value,focused:d.value,details:Fe.value,error:De.value===!1}),{...f,default:Ie=>{let{props:{class:me,...pe},controlRef:Be}=Ie;return k(P,null,[e.prefix&&k("span",{class:"v-text-field__prefix"},[e.prefix]),ge(k("textarea",ie({ref:ne=>_.value=Be.value=ne,class:me,value:n.value,onInput:Ue,autofocus:e.autofocus,readonly:Re.value,disabled:ve.value,placeholder:e.placeholder,rows:e.rows,name:M.fieldName.value,autocomplete:M.fieldAutocomplete.value,onFocus:t,onBlur:u,"aria-labelledby":`${G.value}-label`},pe,H),null),[[we,{handler:w},null,{once:!0}]]),e.autoGrow&&ge(k("textarea",{class:We([me,"v-textarea__sizer"]),id:`${pe.id}-sizer`,"onUpdate:modelValue":ne=>n.value=ne,ref:E,readonly:!0,"aria-hidden":"true"},null),[[je,n.value]]),e.suffix&&k("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:h?R=>{var G;return k(P,null,[(G=f.details)==null?void 0:G.call(f,R),v&&k(P,null,[k("span",null,null),l(st,{active:e.persistentCounter||d.value,value:F.value,max:$.value,disabled:e.disabled},f.counter)])])}:void 0})}),Ze({},C,i,_)}}),xt=ce({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const r=ee(e,"modelValue"),p=de(),g=V({required:n=>!!n||"Required."}),f=()=>g.value.required(r.value.name)===!0;return r.value.redirect_uri.length===0&&r.value.redirect_uri.push(""),r.value.style||(r.value.style={css:""}),(n,d)=>(b(),q(ct,{onSubmit:Je(f,["stop"]),id:"login-form",action:`/${s(p).public.issuerUri}/api/clients`,method:"post"},{default:a(()=>[l(W,null,{default:a(()=>[l(N,{cols:"12"},{default:a(()=>[l(ue,{modelValue:r.value.name,"onUpdate:modelValue":d[0]||(d[0]=x=>r.value.name=x),label:"Name",variant:"outlined",required:"",rules:[g.value.required]},null,8,["modelValue","rules"])]),_:1}),l(N,{cols:"12"},{default:a(()=>[l(ue,{modelValue:r.value.description,"onUpdate:modelValue":d[1]||(d[1]=x=>r.value.description=x),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(W,null,{default:a(()=>[l(N,{cols:"12"},{default:a(()=>[(b(!0),te(P,null,ke(r.value.redirect_uri,(x,u)=>(b(),q(ue,{modelValue:r.value.redirect_uri[u],"onUpdate:modelValue":w=>r.value.redirect_uri[u]=w,label:"Redirect URL",variant:"outlined","append-icon":"mdi:mdi-window-close","onClick:append":w=>r.value.redirect_uri.length>1?r.value.redirect_uri.splice(u,1):""},null,8,["modelValue","onUpdate:modelValue","onClick:append"]))),256))]),_:1})]),_:1}),l(W,null,{default:a(()=>[l(N,null,{default:a(()=>[l(A,{onClick:d[2]||(d[2]=x=>r.value.redirect_uri.push("")),"prepend-icon":"mdi:mdi-plus",color:"primary"},{default:a(()=>[...d[4]||(d[4]=[y(" Add URI ",-1)])]),_:1})]),_:1})]),_:1}),r.value.style?(b(),q(W,{key:0},{default:a(()=>[l(N,null,{default:a(()=>[l(Vt,{modelValue:r.value.style.css,"onUpdate:modelValue":d[3]||(d[3]=x=>r.value.style.css=x),label:"CSS",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})):he("",!0)]),_:1},8,["action"]))}}),L="00000000-0000-0000-0000-000000000000",Ct=ce({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:Ke(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),setup(e,{emit:r}){const p=r,g=de(),f=se.getInstance(),n=ee(e,"modelValue"),d=ee(e,"clients"),x=ee(e,"request-delete"),u=V(),w=V(!!n.value),F=V(),$=V(""),C=V(!1),i=V(!1);S(n,()=>{var m,t;F.value=void 0,n&&(u.value=Z.cloneDeep(n.value),(m=u.value)!=null&&m.client_uuid&&((t=u.value)==null?void 0:t.client_uuid)!==L&&(F.value=()=>{i.value=!0})),w.value=!!n.value}),S(x,()=>{x.value&&(i.value=!0)}),S(i,()=>{i.value||(x.value=!1)});const c=(m,t=!1)=>{if(!m)return;const o=d.value.findIndex(le=>le.client_uuid==m.client_uuid);o>=0?t?d.value.splice(o,1):d.value.splice(o,1,Z.cloneDeep(m)):d.value.push(Z.cloneDeep(m))},_=async m=>{if(!n.value)return;const t=f.getTokenByService("graze");if(n.value.client_uuid&&n.value.client_uuid!==L)try{await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}})||p("error","Unexpected error encountered when updating client")}catch(o){p("error",`Error encountered when updating client: ${o}`)}else try{const o=await $fetch(`${g.public.issuerUri}/api/clients`,{method:"post",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}});u.value=o.Client,c(u.value),C.value=!0,$.value=o.Secret}catch(o){p("error",`Error encountered when removing client: ${o}`)}n.value=void 0},Y=async()=>{if(!n.value||!n.value.client_uuid)return;const m=f.getTokenByService("graze");try{await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${m==null?void 0:m.OAuthToken.AccessToken}`}})&&c(n.value,!0)}catch(t){p("error",`Error encountered when removing client: ${t}`)}n.value=void 0},J=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText($.value)}catch(m){console.error(m.message)}},M=async({callback:m})=>{const t=f.getTokenByService("graze");try{if(!n.value)return;const o=await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}});o&&(C.value=!0,$.value=o.Secret)}catch(o){p("error",`Error encountered when removing client: ${o}`)}await m()};return(m,t)=>(b(),te(P,null,[l(xe,{modelValue:s(w),"onUpdate:modelValue":t[1]||(t[1]=o=>D(w)?w.value=o:null),onClose:t[2]||(t[2]=o=>n.value=void 0),onReset:t[3]||(t[3]=o=>u.value=s(Z.cloneDeep)(n.value)),onSave:_,onDelete:s(F),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(L)?"Close":"Cancel"},Qe({default:a(()=>[s(u)?(b(),q(xt,{key:0,modelValue:s(u),"onUpdate:modelValue":t[0]||(t[0]=o=>D(u)?u.value=o:null)},null,8,["modelValue"])):he("",!0)]),_:2},[s(u)?{name:"title",fn:a(()=>{var o;return[y(j(`${s(u).client_uuid&&s(u).client_uuid!==s(L)?`Edit: ${(o=s(u))==null?void 0:o.name}`:"Create Client"}`),1)]}),key:"0"}:void 0,s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(L)?{name:"actions",fn:a(()=>[l(et,{color:"red-darken-1",variant:"text",onClick:M},{default:a(()=>[...t[11]||(t[11]=[y(" Regenerate Secret ",-1)])]),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),l(xe,{modelValue:s(C),"onUpdate:modelValue":t[4]||(t[4]=o=>D(C)?C.value=o:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:t[5]||(t[5]=o=>{C.value=!1,$.value=""}),onSave:t[6]||(t[6]=o=>{J(),C.value=!1,$.value=""})},{default:a(()=>[t[12]||(t[12]=k("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),k("p",null,[k("span",{onClick:J,class:"cursor-pointer"},j(s($)),1),l(A,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:J})])]),_:1},8,["modelValue"]),l(tt,{modelValue:s(i),"onUpdate:modelValue":t[10]||(t[10]=o=>D(i)?i.value=o:null)},{default:a(()=>[l(be,{color:"error"},{default:a(()=>[l($e,null,{default:a(()=>[l(_e,{class:"d-flex"},{default:a(()=>[t[13]||(t[13]=y(" Confirmation Required ",-1)),l(re),l(A,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:t[7]||(t[7]=o=>i.value=!1)})]),_:1})]),_:1}),l(Se,null,{default:a(()=>[...t[14]||(t[14]=[k("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),k("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])]),_:1}),l(Te,null,{default:a(()=>[l(A,{onClick:t[8]||(t[8]=o=>i.value=!1)},{default:a(()=>[...t[15]||(t[15]=[y(" Close Dialog ",-1)])]),_:1}),l(re),l(A,{onClick:t[9]||(t[9]=o=>{i.value=!1,Y()})},{default:a(()=>[...t[16]||(t[16]=[y(" Delete ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Bt=ce({__name:"dashboard",async setup(e){let r,p;const g=V(),f=V(!1),n=V(""),d=se.getInstance(),x=d.getTokenByService("graze");(!x||d.accessTimeRemaining(x)<=0)&&Ve("/admin");const u=V([]),w=V(!1);try{u.value=([r,p]=Xe(()=>pt()),r=await r,p(),r)}catch(C){C.message.includes("403")&&(d.removeTokensByService("graze"),Ve(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const F=()=>({id:0,client_uuid:L,name:"",description:"",secret:"",redirect_uri:[""],style:{}}),$=C=>{n.value=C,f.value=!0};return(C,i)=>(b(),q(ft,null,{default:a(()=>[l(W,null,{default:a(()=>[l(N,null,{default:a(()=>[(b(!0),te(P,null,ke(s(u),c=>(b(),q(be,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:a(()=>[l($e,null,{default:a(()=>[l(_e,null,{default:a(()=>[y(j(c.name),1)]),_:2},1024),l(lt,null,{default:a(()=>[y(j(c.description),1)]),_:2},1024)]),_:2},1024),l(Se,null,{default:a(()=>[y(" RedirectURI"+j(c.redirect_uri&&c.redirect_uri.length>1?"s":"")+": ",1),c.redirect_uri&&c.redirect_uri.length>0?(b(),q(mt,{key:0,items:c.redirect_uri,density:"compact","bg-color":"transparent",class:"text-medium-emphasis"},null,8,["items"])):(b(),te(P,{key:1},[y(" Unset ")],64))]),_:2},1024),l(Te,null,{default:a(()=>[l(A,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:_=>{g.value=c,w.value=!0}},{default:a(()=>[...i[6]||(i[6]=[y(" Delete ",-1)])]),_:1},8,["onClick"]),l(re),l(A,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:_=>g.value=c},{default:a(()=>[...i[7]||(i[7]=[y(" Edit ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),l(W,null,{default:a(()=>[l(N,{class:"text-right"},{default:a(()=>[l(A,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:i[0]||(i[0]=c=>g.value=F())},{default:a(()=>[...i[8]||(i[8]=[y(" Add Client ",-1)])]),_:1})]),_:1})]),_:1}),l(Ct,{modelValue:s(g),"onUpdate:modelValue":i[1]||(i[1]=c=>D(g)?g.value=c:null),clients:s(u),"onUpdate:clients":i[2]||(i[2]=c=>D(u)?u.value=c:null),requestDelete:s(w),"onUpdate:requestDelete":i[3]||(i[3]=c=>D(w)?w.value=c:null),onError:$},null,8,["modelValue","clients","requestDelete"]),l(at,{modelValue:s(f),"onUpdate:modelValue":i[5]||(i[5]=c=>D(f)?f.value=c:null),timeout:5e3,"multi-line":""},{actions:a(()=>[l(A,{color:"white",variant:"text",onClick:i[4]||(i[4]=c=>f.value=!1)},{default:a(()=>[...i[9]||(i[9]=[y(" Close ",-1)])]),_:1})]),default:a(()=>[y(j(s(n))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{Bt as default};
