import"./B5CZD0j7.js";import{h as g}from"./DU_nv6qb.js";const h=typeof Buffer=="function",p=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A=Array.prototype.slice.call(k),d=(e=>{let t={};return e.forEach((o,s)=>t[o]=s),t})(A),y=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,c=String.fromCharCode.bind(String),u=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),b=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,C=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),o=t-65536;return c((o>>>10)+55296)+c((o&1023)+56320);case 3:return c((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return c((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},S=e=>e.replace(b,C),T=e=>{if(e=e.replace(/\s+/g,""),!y.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,o="",s,i;for(let a=0;a<e.length;)t=d[e.charAt(a++)]<<18|d[e.charAt(a++)]<<12|(s=d[e.charAt(a++)])<<6|(i=d[e.charAt(a++)]),o+=s===64?c(t>>16&255):i===64?c(t>>16&255,t>>8&255):c(t>>16&255,t>>8&255,t&255);return o},x=typeof atob=="function"?e=>atob(_(e)):h?e=>Buffer.from(e,"base64").toString("binary"):T,E=h?e=>u(Buffer.from(e,"base64")):e=>u(x(e).split("").map(t=>t.charCodeAt(0))),I=h?e=>Buffer.from(e,"base64").toString("utf8"):p?e=>p.decode(E(e)):e=>S(x(e)),v=e=>_(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),B=e=>I(v(e));function F(e=""){if(!e&&(e=window.localStorage.getItem("sso_access_token")||"",!e))throw new Error("invalid token");const t=e.split(".");if(t.length!==3)throw new Error("Invalid JWT token");let o="";try{o=B(t[1])}catch(s){throw console.error(t[1]),s}return JSON.parse(o)}function w(e){const t=F(e);if(!t.exp)throw new Error("JWT does not contain an exp claim");const o=Math.floor(Date.now()/1e3);return t.exp<o}const R=()=>{const e=()=>{const r=window.localStorage;r.removeItem("sso_access_token"),r.removeItem("sso_refresh_token")},t=r=>{window.localStorage.setItem("sso_access_token",r)},o=r=>{window.localStorage.setItem("sso_refresh_token",r)},s=async()=>{const r=window.localStorage;let n=r.getItem("sso_access_token");if(!n||w(n)){r.removeItem("sso_access_token");try{await a(),n=r.getItem("sso_access_token")}catch{throw new Error("No valid access token available")}if(!n||w(n))throw new Error("No valid access token available")}return n},i=()=>window.localStorage.getItem("sso_refresh_token"),a=async()=>{const r=g(),n=i(),l=new URLSearchParams;return l.append("grant_type","refresh_token"),l.append("refresh_token",n||""),l.append("client_id","internal"),await $fetch(`${r.public.issuerUri}/connect/token/refresh`,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l.toString(),parseResponse:m=>{const f=JSON.parse(m);return f.access_token&&t(f.access_token),f.refresh_token&&o(f.refresh_token),f}})};return{logout:e,storeAccessToken:t,storeRefreshToken:o,getAccessToken:s,getRefreshToken:i,renewToken:a}};export{F as g,R as u};
