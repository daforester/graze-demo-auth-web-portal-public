import{_ as x}from"./csius0aV.js";import{L as w,_ as E}from"./BQPon57O.js";import{u as b}from"./BGfnDYWo.js";import{u as q}from"./DANHJ8r9.js";import{h as B,e as O,V as S,M as $,W as N,r as M,c as A,o as r,f as l,R as c,w as e,b as t,Y as J,X as U,a as P,t as z,g as C,J as G,d as F}from"./DU_nv6qb.js";import{V as f,a as m}from"./DVHrX6do.js";import{u as I}from"./mm0nQsJ-.js";import{V as K}from"./epPG9Ibe.js";import{v as D}from"./BFc9MCJK.js";import"./DeTKzWR2.js";import"./BLGJzCYI.js";import"./CglTRRRa.js";import"./9qXTopoB.js";import"./C3fS7Lrv.js";import"./B9QUwcU4.js";import"./Dwcg0_5Q.js";import"./71MGMbUJ.js";import"./1d_XzYus.js";import"./B5CZD0j7.js";const j=async i=>{const d=B();try{const o=await $fetch(`${d.public.issuerUri}/connect/auth/urls?baseRedirect=${i}`,{method:"get",parseResponse:y=>y}),g=JSON.parse(o);return new Map(Object.entries(g.URLs))}catch(o){throw o}},W=O({__name:"LoginButtons",props:{showAmazonLogin:{type:Boolean,default:!1},showEmailLogin:{type:Boolean,default:!1},showFaceBookLogin:{type:Boolean,default:!1},showGoogleLogin:{type:Boolean,default:!1},showInstagramLogin:{type:Boolean,default:!1},showKeycloakLogin:{type:Boolean,default:!1},showMicrosoftLogin:{type:Boolean,default:!1},showSteamLogin:{type:Boolean,default:!1},showTelegramLogin:{type:Boolean,default:!1},showTwitchLogin:{type:Boolean,default:!1},showTwitterLogin:{type:Boolean,default:!1}},emits:["login"],async setup(i,{emit:d}){let o,g;const{addState:y}=q(),v=b(),_=S(),p=$();try{p.value=([o,g]=N(()=>j(`${window.location.origin}${_.resolve("/connect/external").href}`)),o=await o,g(),o)}catch(s){console.error(s)}const h=d,a=$("");return M(a,()=>{var T;const s=(T=p.value)==null?void 0:T.get(a.value);if(!s){h("login",{method:a.value});return}const u=new URL(s).searchParams.get("state");u&&y(u,v),h("login",{method:a.value,uri:s})}),(s,n)=>(r(),A("div",null,[s.showEmailLogin?(r(),l(f,{key:0,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"internal",onClick:n[0]||(n[0]=u=>a.value="internal")})]),_:1})]),_:1})):c("",!0),s.showAmazonLogin?(r(),l(f,{key:1,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"amazon",onClick:n[1]||(n[1]=u=>a.value="amazon")})]),_:1})]),_:1})):c("",!0),s.showFaceBookLogin?(r(),l(f,{key:2,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"facebook",onClick:n[2]||(n[2]=u=>a.value="facebook")})]),_:1})]),_:1})):c("",!0),s.showGoogleLogin?(r(),l(f,{key:3,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"google",onClick:n[3]||(n[3]=u=>a.value="google")})]),_:1})]),_:1})):c("",!0),s.showInstagramLogin?(r(),l(f,{key:4,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"instagram",onClick:n[4]||(n[4]=u=>a.value="instagram")})]),_:1})]),_:1})):c("",!0),s.showMicrosoftLogin?(r(),l(f,{key:5,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"microsoft",onClick:n[5]||(n[5]=u=>a.value="microsoft")})]),_:1})]),_:1})):c("",!0),s.showSteamLogin?(r(),l(f,{key:6,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"steam",onClick:n[6]||(n[6]=u=>a.value="steam")})]),_:1})]),_:1})):c("",!0),s.showTelegramLogin?(r(),l(f,{key:7,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"telegram"})]),_:1})]),_:1})):c("",!0),s.showTwitchLogin?(r(),l(f,{key:8,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"twitch",onClick:n[7]||(n[7]=u=>a.value="twitch")})]),_:1})]),_:1})):c("",!0),s.showTwitterLogin?(r(),l(f,{key:9,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"twitter",onClick:n[8]||(n[8]=u=>a.value="twitter")})]),_:1})]),_:1})):c("",!0),s.showKeycloakLogin?(r(),l(f,{key:10,dense:!0},{default:e(()=>[t(m,null,{default:e(()=>[t(w,{source:"keycloak",onClick:n[9]||(n[9]=u=>a.value="keycloak")})]),_:1})]),_:1})):c("",!0)]))}}),X=()=>{try{const i=S(),d=i.currentRoute.value.query.state||"",o=new URL(i.currentRoute.value.query.redirect_uri||"");return o.searchParams.set("state",d),o.toString()}catch(i){console.error(i)}return""},Y=async i=>{const d=B();try{return await $fetch(`${d.public.issuerUri}/connect/style/${i}`,{method:"get",parseResponse:o=>{try{return JSON.parse(o)}catch{throw o}}})}catch{return{}}},H=async i=>{const d=B(),{getAccessToken:o,storeAccessToken:g,storeRefreshToken:y}=I();let v="";try{v=await o()}catch{throw new Error("no access token available")}try{return await $fetch(`${d.public.issuerUri}/connect/auth/token`,{method:"post",body:JSON.stringify({oauth:i,access_token:v,new:!1}),parseResponse:_=>{const p=JSON.parse(_);return p.AccessToken&&g(p.AccessToken),p.RefreshToken&&y(p.RefreshToken),{RedirectURI:p.RedirectURI||"",Existing:p.Existing||!1}}})}catch(_){throw _}},Q={class:"text-center"},he=O({__name:"auth",emits:["pageTitle"],async setup(i,{emit:d}){let o,g;const y=B(),{getAccessToken:v}=I();d("pageTitle","Login");const p=X(),h=$("BUTTONS");let a;try{a=([o,g]=N(()=>v()),o=await o,g(),o)}catch{}a&&(async()=>{try{if(J().query.state){const k=b(),R=await H(k);R&&(new URL(R).searchParams.get("error")||U(R,{external:!0}))}}catch{}})();const n=({method:L,uri:k})=>{switch(L){case"internal":h.value="INTERNAL_LOGIN";break;case"keycloak":U(k,{external:!0});break}},u=S(),T=([o,g]=N(()=>Y(u.currentRoute.value.query.client_id)),o=await o,g(),o);if(T){const L=document.createElement("style");L.textContent=T.css,document.head.append(L)}return(L,k)=>{const R=x;return r(),l(K,null,{default:e(()=>[P("h1",Q,z(C(y).public.organisationName),1),C(h)=="BUTTONS"?(r(),A(G,{key:0},[t(W,{showEmailLogin:!0,showKeycloakLogin:!0,showTelegramLogin:!0,onLogin:n,style:{"max-width":"250px"},class:"ma-auto mb-5"}),t(f,null,{default:e(()=>[t(m,{class:"pa-0 text-center"},{default:e(()=>[t(R,{href:C(p)},{default:e(()=>[t(D,{variant:"text"},{default:e(()=>k[1]||(k[1]=[F(" Cancel ")])),_:1})]),_:1},8,["href"])]),_:1})]),_:1})],64)):C(h)=="INTERNAL_LOGIN"?(r(),l(E,{key:1,onCancel:k[0]||(k[0]=V=>h.value="BUTTONS")})):c("",!0)]),_:1})}}});export{he as default};
