import{T as oe}from"./D0hecO8S.js";import{h as ue,i as Ue,p as Re,E as Ae,l as J,M as V,s as De,ah as Be,$ as Fe,r as D,a7 as Ie,N as ze,b as l,C as le,P as ae,ai as Pe,aj as qe,J as P,F as fe,G as Ee,ak as Me,Q as Ne,e as re,al as W,f as q,o as $,g as s,T as He,w as a,R as Ce,c as X,U as ye,d as x,am as Oe,an as Ge,t as N,S as B,a as O,X as me,W as Le}from"./Dfz0Oeny.js";import{f as je,j as Je,m as Q,_ as pe,b as xe,d as we,e as ke,i as he,k as $e,V as Qe,h as We,n as Xe}from"./UTIaXtRO.js";import{u as Ye,V as ge,a as Ve,m as Ke,b as Ze,c as et,d as tt,e as ne}from"./P-XqHuno.js";import{V as H,a as z}from"./B07CVZge.js";import{v as S}from"./Clxg_Pcy.js";import{I as lt,d as ie}from"./bGDoBeuJ.js";import{u as at}from"./CdjNjyL0.js";import{V as nt}from"./Duxx-1-J.js";import{V as it}from"./C1fCV21g.js";import"./B5CZD0j7.js";import"./R6Kz3WOr.js";import"./BcpAquWb.js";import"./BtU6meN-.js";import"./DIXcYNAC.js";const ot=async()=>{const e=ue(),p=oe.getInstance().getTokenByService("graze");return await $fetch(`${e.public.issuerUri}/api/clients`,{method:"get",headers:{Authorization:`Bearer ${p==null?void 0:p.OAuthToken.AccessToken}`}})},ut=Re({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Ze(),...Ke()},"VTextarea"),rt=Ue()({name:"VTextarea",directives:{Intersect:lt},inheritAttrs:!1,props:ut(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,r){let{attrs:p,emit:g,slots:f}=r;const n=Ae(e,"modelValue"),{isFocused:d,focus:C,blur:u}=Ye(e),w=J(()=>typeof e.counterValue=="function"?e.counterValue(n.value):(n.value||"").toString().length),F=J(()=>{if(p.maxlength)return p.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function b(v,h){var k,_;!e.autofocus||!v||(_=(k=h[0].target)==null?void 0:k.focus)==null||_.call(k)}const y=V(),i=V(),c=De(""),T=V(),Y=J(()=>e.persistentPlaceholder||d.value||e.active);function I(){var v;T.value!==document.activeElement&&((v=T.value)==null||v.focus()),d.value||C()}function K(v){I(),g("click:control",v)}function m(v){g("mousedown:control",v)}function t(v){v.stopPropagation(),I(),ae(()=>{n.value="",Ne(e["onClick:clear"],v)})}function o(v){var k;const h=v.target;if(n.value=h.value,(k=e.modelModifiers)!=null&&k.trim){const _=[h.selectionStart,h.selectionEnd];ae(()=>{h.selectionStart=_[0],h.selectionEnd=_[1]})}}const U=V(),G=V(Number(e.rows)),Z=J(()=>["plain","underlined"].includes(e.variant));Be(()=>{e.autoGrow||(G.value=Number(e.rows))});function E(){e.autoGrow&&ae(()=>{if(!U.value||!i.value)return;const v=getComputedStyle(U.value),h=getComputedStyle(i.value.$el),k=parseFloat(v.getPropertyValue("--v-field-padding-top"))+parseFloat(v.getPropertyValue("--v-input-padding-top"))+parseFloat(v.getPropertyValue("--v-field-padding-bottom")),_=U.value.scrollHeight,L=parseFloat(v.lineHeight),ee=Math.max(parseFloat(e.rows)*L+k,parseFloat(h.getPropertyValue("--v-input-control-height"))),te=parseFloat(e.maxRows)*L+k||1/0,A=qe(_??0,ee,te);G.value=Math.floor((A-k)/L),c.value=Pe(A)})}Fe(E),D(n,E),D(()=>e.rows,E),D(()=>e.maxRows,E),D(()=>e.density,E);let R;return D(U,v=>{v?(R=new ResizeObserver(E),R.observe(U.value)):R==null||R.disconnect()}),Ie(()=>{R==null||R.disconnect()}),at(()=>{const v=!!(f.counter||e.counter||e.counterValue),h=!!(v||f.details),[k,_]=ze(p),{modelValue:L,...ee}=ge.filterProps(e),te=Ve.filterProps(e);return l(ge,le({ref:y,modelValue:n.value,"onUpdate:modelValue":A=>n.value=A,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":Z.value},e.class],style:e.style},k,ee,{centerAffix:G.value===1&&!Z.value,focused:d.value}),{...f,default:A=>{let{id:j,isDisabled:se,isDirty:de,isReadonly:be,isValid:_e}=A;return l(Ve,le({ref:i,style:{"--v-textarea-control-height":c.value},onClick:K,onMousedown:m,"onClick:clear":t,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},te,{id:j.value,active:Y.value||de.value,centerAffix:G.value===1&&!Z.value,dirty:de.value||e.dirty,disabled:se.value,focused:d.value,error:_e.value===!1}),{...f,default:Se=>{let{props:{class:ce,...ve}}=Se;return l(P,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),fe(l("textarea",le({ref:T,class:ce,value:n.value,onInput:o,autofocus:e.autofocus,readonly:be.value,disabled:se.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:I,onBlur:u},ve,_),null),[[Ee("intersect"),{handler:b},null,{once:!0}]]),e.autoGrow&&fe(l("textarea",{class:[ce,"v-textarea__sizer"],id:`${ve.id}-sizer`,"onUpdate:modelValue":Te=>n.value=Te,ref:U,readonly:!0,"aria-hidden":"true"},null),[[Me,n.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:h?A=>{var j;return l(P,null,[(j=f.details)==null?void 0:j.call(f,A),v&&l(P,null,[l("span",null,null),l(et,{active:e.persistentCounter||d.value,value:w.value,max:F.value,disabled:e.disabled},f.counter)])])}:void 0})}),je({},y,i,T)}}),st=re({__name:"EditClientForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(e){const r=W(e,"modelValue"),p=ue(),g=V({required:n=>!!n||"Required."}),f=()=>g.value.required(r.value.name)===!0;return r.value.redirect_uri.length===0&&r.value.redirect_uri.push(""),r.value.style||(r.value.style={css:""}),(n,d)=>($(),q(tt,{onSubmit:He(f,["stop"]),id:"login-form",action:`/${s(p).public.issuerUri}/api/clients`,method:"post"},{default:a(()=>[l(H,null,{default:a(()=>[l(z,{cols:"12"},{default:a(()=>[l(ne,{modelValue:r.value.name,"onUpdate:modelValue":d[0]||(d[0]=C=>r.value.name=C),label:"Name",variant:"outlined",required:"",rules:[g.value.required]},null,8,["modelValue","rules"])]),_:1}),l(z,{cols:"12"},{default:a(()=>[l(ne,{modelValue:r.value.description,"onUpdate:modelValue":d[1]||(d[1]=C=>r.value.description=C),label:"Description",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),l(H,null,{default:a(()=>[l(z,{cols:"12"},{default:a(()=>[($(!0),X(P,null,ye(r.value.redirect_uri,(C,u)=>($(),q(ne,{modelValue:r.value.redirect_uri[u],"onUpdate:modelValue":w=>r.value.redirect_uri[u]=w,label:"Redirect URL",variant:"outlined","append-icon":"mdi:mdi-window-close","onClick:append":w=>r.value.redirect_uri.length>1?r.value.redirect_uri.splice(u,1):""},null,8,["modelValue","onUpdate:modelValue","onClick:append"]))),256))]),_:1})]),_:1}),l(H,null,{default:a(()=>[l(z,null,{default:a(()=>[l(S,{onClick:d[2]||(d[2]=C=>r.value.redirect_uri.push("")),"prepend-icon":"mdi:mdi-plus",color:"primary"},{default:a(()=>d[4]||(d[4]=[x(" Add URI ")])),_:1})]),_:1})]),_:1}),r.value.style?($(),q(H,{key:0},{default:a(()=>[l(z,null,{default:a(()=>[l(rt,{modelValue:r.value.style.css,"onUpdate:modelValue":d[3]||(d[3]=C=>r.value.style.css=C),label:"CSS",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})):Ce("",!0)]),_:1},8,["action"]))}}),M="00000000-0000-0000-0000-000000000000",dt=re({__name:"ClientDialog",props:{modelValue:{required:!1},modelModifiers:{},clients:{required:!0},clientsModifiers:{},"request-delete":{type:Boolean,required:!1},"request-deleteModifiers":{}},emits:Oe(["error","secret"],["update:modelValue","update:clients","update:request-delete"]),setup(e,{emit:r}){const p=r,g=ue(),f=oe.getInstance(),n=W(e,"modelValue"),d=W(e,"clients"),C=W(e,"request-delete"),u=V(),w=V(!!n.value),F=V(),b=V(""),y=V(!1),i=V(!1);D(n,()=>{var m,t;F.value=void 0,n&&(u.value=Q.cloneDeep(n.value),(m=u.value)!=null&&m.client_uuid&&((t=u.value)==null?void 0:t.client_uuid)!==M&&(F.value=()=>{i.value=!0})),w.value=!!n.value}),D(C,()=>{C.value&&(i.value=!0)}),D(i,()=>{i.value||(C.value=!1)});const c=(m,t=!1)=>{if(!m)return;const o=d.value.findIndex(U=>U.client_uuid==m.client_uuid);o>=0?t?d.value.splice(o,1):d.value.splice(o,1,Q.cloneDeep(m)):d.value.push(Q.cloneDeep(m))},T=async m=>{if(!n.value)return;const t=f.getTokenByService("graze");if(n.value.client_uuid&&n.value.client_uuid!==M)try{await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}`,{method:"put",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}})||p("error","Unexpected error encountered when updating client")}catch(o){p("error",`Error encountered when updating client: ${o}`)}else try{const o=await $fetch(`${g.public.issuerUri}/api/clients`,{method:"post",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`},body:{Client:u.value}});u.value=o.Client,c(u.value),y.value=!0,b.value=o.Secret}catch(o){p("error",`Error encountered when removing client: ${o}`)}n.value=void 0},Y=async()=>{if(!n.value||!n.value.client_uuid)return;const m=f.getTokenByService("graze");try{await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}`,{method:"delete",headers:{Authorization:`Bearer ${m==null?void 0:m.OAuthToken.AccessToken}`}})&&c(n.value,!0)}catch(t){p("error",`Error encountered when removing client: ${t}`)}n.value=void 0},I=async()=>{try{navigator.clipboard&&await navigator.clipboard.writeText(b.value)}catch(m){console.error(m.message)}},K=async({callback:m})=>{const t=f.getTokenByService("graze");try{if(!n.value)return;const o=await $fetch(`${g.public.issuerUri}/api/client/${n.value.client_uuid}/secret`,{method:"get",headers:{Authorization:`Bearer ${t==null?void 0:t.OAuthToken.AccessToken}`}});o&&(y.value=!0,b.value=o.Secret)}catch(o){p("error",`Error encountered when removing client: ${o}`)}await m()};return(m,t)=>($(),X(P,null,[l(pe,{modelValue:s(w),"onUpdate:modelValue":t[1]||(t[1]=o=>B(w)?w.value=o:null),onClose:t[2]||(t[2]=o=>n.value=void 0),onReset:t[3]||(t[3]=o=>u.value=s(Q.cloneDeep)(n.value)),onSave:T,onDelete:s(F),"hide-extension":!0,"show-save-action":!0,"show-reset-action":!0,"show-close-action":!0,"close-action-label":s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(M)?"Close":"Cancel"},Ge({default:a(()=>[s(u)?($(),q(st,{key:0,modelValue:s(u),"onUpdate:modelValue":t[0]||(t[0]=o=>B(u)?u.value=o:null)},null,8,["modelValue"])):Ce("",!0)]),_:2},[s(u)?{name:"title",fn:a(()=>{var o;return[x(N(`${s(u).client_uuid&&s(u).client_uuid!==s(M)?`Edit: ${(o=s(u))==null?void 0:o.name}`:"Create Client"}`),1)]}),key:"0"}:void 0,s(u)&&s(u).client_uuid&&s(u).client_uuid!==s(M)?{name:"actions",fn:a(()=>[l(Je,{color:"red-darken-1",variant:"text",onClick:K},{default:a(()=>t[11]||(t[11]=[x(" Regenerate Secret ")])),_:1})]),key:"1"}:void 0]),1032,["modelValue","onDelete","close-action-label"]),l(pe,{modelValue:s(y),"onUpdate:modelValue":t[4]||(t[4]=o=>B(y)?y.value=o:null),"show-close-action":!0,"close-action-label":"Close","hide-extension":!0,title:"New Client Secret",onClose:t[5]||(t[5]=o=>{y.value=!1,b.value=""}),onSave:t[6]||(t[6]=o=>{I(),y.value=!1,b.value=""})},{default:a(()=>[t[12]||(t[12]=O("p",{class:"mb-4"}," The following secret was generated, it will not be displayed again: ",-1)),O("p",null,[O("span",{onClick:I,class:"cursor-pointer"},N(s(b)),1),l(S,{"append-icon":"mdi:mdi-clipboard-outline",size:"medium",variant:"text",class:"ml-3",onClick:I})])]),_:1},8,["modelValue"]),l(Qe,{modelValue:s(i),"onUpdate:modelValue":t[10]||(t[10]=o=>B(i)?i.value=o:null)},{default:a(()=>[l(xe,{color:"error"},{default:a(()=>[l(we,null,{default:a(()=>[l(ke,{class:"d-flex"},{default:a(()=>[t[13]||(t[13]=x(" Confirmation Required ")),l(ie),l(S,{icon:"mdi:mdi-close",size:"x-small",variant:"text",onClick:t[7]||(t[7]=o=>i.value=!1)})]),_:1})]),_:1}),l(he,null,{default:a(()=>t[14]||(t[14]=[O("p",{class:"mb-4"},"Are you sure you wish to delete this client?",-1),O("p",null,"Any services logging in with this client identity and secret will cease to function.",-1)])),_:1}),l($e,null,{default:a(()=>[l(S,{onClick:t[8]||(t[8]=o=>i.value=!1)},{default:a(()=>t[15]||(t[15]=[x(" Close Dialog ")])),_:1}),l(ie),l(S,{onClick:t[9]||(t[9]=o=>{i.value=!1,Y()})},{default:a(()=>t[16]||(t[16]=[x(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),_t=re({__name:"dashboard",async setup(e){let r,p;const g=V(),f=V(!1),n=V(""),d=oe.getInstance(),C=d.getTokenByService("graze");(!C||d.accessTimeRemaining(C)<=0)&&me("/admin");const u=V([]),w=V(!1);try{u.value=([r,p]=Le(()=>ot()),r=await r,p(),r)}catch(y){y.message.includes("403")&&(d.removeTokensByService("graze"),me(`/admin?error=access_denied&error_description=${encodeURIComponent("You are not authorised to access this service.")}`))}const F=()=>({id:0,client_uuid:M,name:"",description:"",secret:"",redirect_uri:[""],style:{}}),b=y=>{n.value=y,f.value=!0};return(y,i)=>($(),q(nt,null,{default:a(()=>[l(H,null,{default:a(()=>[l(z,null,{default:a(()=>[($(!0),X(P,null,ye(s(u),c=>($(),q(xe,{color:"grey-lighten-3",variant:"elevated",elevation:"16"},{default:a(()=>[l(we,null,{default:a(()=>[l(ke,null,{default:a(()=>[x(N(c.name),1)]),_:2},1024),l(We,null,{default:a(()=>[x(N(c.description),1)]),_:2},1024)]),_:2},1024),l(he,null,{default:a(()=>[x(" RedirectURI"+N(c.redirect_uri&&c.redirect_uri.length>1?"s":"")+": ",1),c.redirect_uri&&c.redirect_uri.length>0?($(),q(it,{key:0,items:c.redirect_uri,density:"compact","bg-color":"transparent",class:"text-medium-emphasis"},null,8,["items"])):($(),X(P,{key:1},[x(" Unset ")],64))]),_:2},1024),l($e,null,{default:a(()=>[l(S,{color:"error","prepend-icon":"mdi:mdi-delete",variant:"elevated",onClick:T=>{g.value=c,w.value=!0}},{default:a(()=>i[6]||(i[6]=[x(" Delete ")])),_:2},1032,["onClick"]),l(ie),l(S,{color:"primary","prepend-icon":"mdi:mdi-pencil",variant:"elevated",onClick:T=>g.value=c},{default:a(()=>i[7]||(i[7]=[x(" Edit ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1}),l(H,null,{default:a(()=>[l(z,{class:"text-right"},{default:a(()=>[l(S,{"prepend-icon":"mdi:mdi-plus",color:"primary",onClick:i[0]||(i[0]=c=>g.value=F())},{default:a(()=>i[8]||(i[8]=[x(" Add Client ")])),_:1})]),_:1})]),_:1}),l(dt,{modelValue:s(g),"onUpdate:modelValue":i[1]||(i[1]=c=>B(g)?g.value=c:null),clients:s(u),"onUpdate:clients":i[2]||(i[2]=c=>B(u)?u.value=c:null),requestDelete:s(w),"onUpdate:requestDelete":i[3]||(i[3]=c=>B(w)?w.value=c:null),onError:b},null,8,["modelValue","clients","requestDelete"]),l(Xe,{modelValue:s(f),"onUpdate:modelValue":i[5]||(i[5]=c=>B(f)?f.value=c:null),timeout:5e3,"multi-line":""},{actions:a(()=>[l(S,{color:"white",variant:"text",onClick:i[4]||(i[4]=c=>f.value=!1)},{default:a(()=>i[9]||(i[9]=[x(" Close ")])),_:1})]),default:a(()=>[x(N(s(n))+" ",1)]),_:1},8,["modelValue"])]),_:1}))}});export{_t as default};
